-- Advanced Roblox UI Library (Rayfield Style)
-- Features:
-- ✅ Draggable window (title-bar only, optional)
-- ✅ Tabs + Sections
-- ✅ Buttons, Toggles, Dropdowns
-- ✅ Rayfield-style aesthetics
-- ✅ Dark theme

local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local UILib = {}

-- Themes
local Themes = {
    Dark = {
        Background = Color3.fromRGB(30,30,30),
        Section = Color3.fromRGB(45,45,45),
        Element = Color3.fromRGB(60,60,60),
        Accent = Color3.fromRGB(0,170,255),
        Text = Color3.fromRGB(255,255,255)
    }
}

local CurrentTheme = Themes.Dark

function UILib:SetTheme(name)
    if Themes[name] then CurrentTheme = Themes[name] end
end

local function createGui()
    local gui = Instance.new("ScreenGui")
    gui.ResetOnSpawn = false
    gui.Parent = Player:WaitForChild("PlayerGui")
    return gui
end

function UILib:CreateWindow(title, settings)
    settings = settings or {}
    local draggable = settings.Draggable ~= false

    local gui = createGui()

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 520, 0, 360)
    frame.Position = UDim2.new(0.5, -260, 0.5, -180)
    frame.BackgroundColor3 = CurrentTheme.Background
    frame.BorderSizePixel = 0
    frame.Parent = gui
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

    -- Title bar
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1,0,0,40)
    titleBar.BackgroundTransparency = 1
    titleBar.Parent = frame

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1,0,1,0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title or "Window"
    titleLabel.TextColor3 = CurrentTheme.Text
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 20
    titleLabel.Parent = titleBar

    -- Proper dragging
    if draggable then
        local dragging, dragStart, startPos
        titleBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = frame.Position
            end
        end)
        UIS.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
        end)
        UIS.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
    end

    -- Tabs
    local tabBar = Instance.new("Frame")
    tabBar.Position = UDim2.new(0,10,0,45)
    tabBar.Size = UDim2.new(1,-20,0,35)
    tabBar.BackgroundTransparency = 1
    tabBar.Parent = frame

    local tabLayout = Instance.new("UIListLayout")
    tabLayout.FillDirection = Enum.FillDirection.Horizontal
    tabLayout.Padding = UDim.new(0,6)
    tabLayout.Parent = tabBar

    local pages = Instance.new("Frame")
    pages.Position = UDim2.new(0,10,0,90)
    pages.Size = UDim2.new(1,-20,1,-100)
    pages.BackgroundTransparency = 1
    pages.Parent = frame

    local window = {}
    local currentPage

    function window:CreateTab(name)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0,120,1,0)
        btn.BackgroundColor3 = CurrentTheme.Section
        btn.Text = name
        btn.TextColor3 = CurrentTheme.Text
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 16
        btn.Parent = tabBar
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)

        local page = Instance.new("Frame")
        page.Size = UDim2.new(1,0,1,0)
        page.Visible = false
        page.BackgroundTransparency = 1
        page.Parent = pages

        local pageLayout = Instance.new("UIListLayout")
        pageLayout.Padding = UDim.new(0,10)
        pageLayout.FillDirection = Enum.FillDirection.Vertical
        pageLayout.SortOrder = Enum.SortOrder.LayoutOrder
        pageLayout.Parent = page

        btn.MouseButton1Click:Connect(function()
            if currentPage then currentPage.Visible = false end
            currentPage = page
            page.Visible = true
        end)

        if not currentPage then
            currentPage = page
            page.Visible = true
        end

        local tab = {}

        function tab:CreateSection(title)
            local section = Instance.new("Frame")
            section.BackgroundColor3 = CurrentTheme.Element
            section.Size = UDim2.new(1,0,0,0)
            section.AutomaticSize = Enum.AutomaticSize.Y
            section.Parent = page
            Instance.new("UICorner", section).CornerRadius = UDim.new(0,8)

            local layout = Instance.new("UIListLayout")
            layout.Padding = UDim.new(0,6)
            layout.FillDirection = Enum.FillDirection.Vertical
            layout.SortOrder = Enum.SortOrder.LayoutOrder
            layout.Parent = section

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1,-10,0,24)
            label.BackgroundTransparency = 1
            label.Text = title
            label.TextColor3 = CurrentTheme.Text
            label.Font = Enum.Font.GothamBold
            label.TextSize = 16
            label.LayoutOrder = 1
            label.Parent = section

            local sectionAPI = {}

            function sectionAPI:AddButton(text, callback)
                local b = Instance.new("TextButton")
                b.Size = UDim2.new(1,-10,0,28)
                b.BackgroundColor3 = CurrentTheme.Section
                b.Text = text
                b.TextColor3 = CurrentTheme.Text
                b.Font = Enum.Font.Gotham
                b.TextSize = 14
                b.LayoutOrder = #section:GetChildren() + 1
                b.Parent = section
                Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)

                b.MouseButton1Click:Connect(function()
                    if callback then callback() end
                end)
            end

            function sectionAPI:AddToggle(text, callback)
                local state = false
                local t = Instance.new("TextButton")
                t.Size = UDim2.new(1,-10,0,28)
                t.BackgroundColor3 = CurrentTheme.Section
                t.Text = text .. " : OFF"
                t.TextColor3 = CurrentTheme.Text
                t.Font = Enum.Font.Gotham
                t.TextSize = 14
                t.LayoutOrder = #section:GetChildren() + 1
                t.Parent = section
                Instance.new("UICorner", t).CornerRadius = UDim.new(0,6)

                t.MouseButton1Click:Connect(function()
                    state = not state
                    t.Text = text .. (state and " : ON" or " : OFF")
                    if callback then callback(state) end
                end)
            end

            function sectionAPI:AddDropdown(text, options, callback)
                local d = Instance.new("TextButton")
                d.Size = UDim2.new(1,-10,0,28)
                d.BackgroundColor3 = CurrentTheme.Section
                d.Text = text .. ": " .. (options[1] or "")
                d.TextColor3 = CurrentTheme.Text
                d.Font = Enum.Font.Gotham
                d.TextSize = 14
                d.LayoutOrder = #section:GetChildren() + 1
                d.Parent = section
                Instance.new("UICorner", d).CornerRadius = UDim.new(0,6)

                local currentIndex = 1
                d.MouseButton1Click:Connect(function()
                    currentIndex = currentIndex % #options + 1
                    d.Text = text .. ": " .. options[currentIndex]
                    if callback then callback(options[currentIndex]) end
                end)
            end

            return sectionAPI
        end

        return tab
    end

    return window
end

return UILib